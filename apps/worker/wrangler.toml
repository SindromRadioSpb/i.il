name = "iil"
main = "src/index.ts"
compatibility_date = "2026-02-27"

# Default (dev) D1 binding
[[d1_databases]]
binding = "DB"
database_name = "news_hub_dev"
database_id = "3e74b9fd-b0b3-4022-ac3d-d08306015420"

# Default vars (dev defaults — safe: cron and FB disabled)
# ANTHROPIC_API_KEY is a secret — set via: wrangler secret put ANTHROPIC_API_KEY
[vars]
CRON_ENABLED = "false"
FB_POSTING_ENABLED = "false"
ADMIN_ENABLED = "false"
CRON_INTERVAL_MIN = "10"
MAX_NEW_ITEMS_PER_RUN = "25"
SUMMARY_TARGET_MIN = "400"
SUMMARY_TARGET_MAX = "700"
ANTHROPIC_MODEL = "claude-haiku-4-5-20251001"
GEMINI_MODEL = "gemini-2.0-flash"
SUMMARY_PROVIDERS = "gemini,claude,rule_based"

# Cron trigger — 3×/day (05:00 / 11:00 / 18:00 UTC = 07/13/20 IST)
# Matches Gemini free tier: 15 calls/day → 5 summaries × 3 runs
[triggers]
crons = ["0 5,11,18 * * *"]

# ── Production environment ────────────────────────────────────────────────────
[env.production]

[[env.production.d1_databases]]
binding = "DB"
database_name = "news_hub_prod"
database_id = "32403483-6512-4673-aaff-a3a6e3c9aad3"

# ANTHROPIC_API_KEY is a secret — set via: wrangler secret put ANTHROPIC_API_KEY --env production
[env.production.vars]
CRON_ENABLED = "true"
FB_POSTING_ENABLED = "false"
ADMIN_ENABLED = "false"
CRON_INTERVAL_MIN = "10"
MAX_NEW_ITEMS_PER_RUN = "25"
SUMMARY_TARGET_MIN = "400"
SUMMARY_TARGET_MAX = "700"
ANTHROPIC_MODEL = "claude-haiku-4-5-20251001"
GEMINI_MODEL = "gemini-2.0-flash"
SUMMARY_PROVIDERS = "gemini,claude,rule_based"

[env.production.triggers]
crons = ["0 5,11,18 * * *"]

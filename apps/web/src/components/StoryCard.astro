---
interface Props {
  storyId: string;
  titleRu: string | null;
  excerptRu: string | null;
  category: string;
  riskLevel: string;
  sourceCount: number;
  lastUpdate: string;
}

const { storyId, titleRu, excerptRu, category, riskLevel, sourceCount, lastUpdate } = Astro.props;

const displayTitle = titleRu ?? 'Новость обрабатывается…';

const dt = new Date(lastUpdate);
const timeLabel = dt.toLocaleDateString('ru-RU', {
  day: 'numeric',
  month: 'short',
  hour: '2-digit',
  minute: '2-digit',
});

const CATEGORY_LABELS: Record<string, string> = {
  politics: 'политика',
  security: 'безопасность',
  economy: 'экономика',
  society: 'общество',
  tech: 'технологии',
  health: 'здоровье',
  culture: 'культура',
  sport: 'спорт',
  weather: 'погода',
  other: 'другое',
};
const categoryLabel = CATEGORY_LABELS[category] ?? category;
---

<article class="card">
  <a href={`/story/${storyId}`} class="card__link">
    <div class="card__meta">
      <span class={`badge badge--${riskLevel}`}>{categoryLabel}</span>
      <time datetime={lastUpdate} class="card__time">{timeLabel}</time>
    </div>
    <h2 class="card__title">{displayTitle}</h2>
    {excerptRu && <p class="card__excerpt">{excerptRu}</p>}
    <div class="card__footer">
      {sourceCount} {sourceCount === 1 ? 'источник' : sourceCount < 5 ? 'источника' : 'источников'}
    </div>
  </a>
</article>

<style>
  .card { margin-bottom: 0.75rem; }
  .card__link {
    display: block;
    padding: 1rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--card);
    text-decoration: none;
    color: inherit;
    transition: box-shadow 0.15s, border-color 0.15s;
  }
  .card__link:hover {
    box-shadow: 0 2px 10px rgba(0,0,0,0.07);
    border-color: #ccc;
  }
  .card__meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.4rem;
  }
  .badge {
    display: inline-block;
    padding: 2px 7px;
    border-radius: 4px;
    font-size: 0.72rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }
  .badge--high { background: #fde8e8; color: var(--risk-high); }
  .badge--medium { background: #fef3e2; color: var(--risk-medium); }
  .badge--low { background: #e8f5e9; color: var(--risk-low); }
  .card__time { font-size: 0.78rem; color: var(--muted); }
  .card__title { font-size: 1.05rem; font-weight: 600; line-height: 1.4; margin-bottom: 0.35rem; }
  .card__excerpt { font-size: 0.88rem; color: var(--muted); line-height: 1.55; margin-bottom: 0.5rem; }
  .card__footer { font-size: 0.78rem; color: var(--muted); }
</style>
